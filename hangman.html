<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <audio id="correctAudio">
        <source src="https://www.zapsplat.com/wp-content/uploads/2015/sound-effects-10157/zapsplat_multimedia_game_star_win_gain_x1_12387.mp3"
            type="audio/mpeg">
    </audio>
    <audio id="errorAudio">
        <source src="https://www.zapsplat.com/wp-content/uploads/2015/sound-effects-three/leisure_retro_arcade_game_incorrect_error_tone.mp3"
            type="audio/mpeg">
    </audio>

    <h1>Web Dev Hangman</h1>
    <h3>Instructions:Get a word right to gain 1 point and 2 extra hp, you lose 1 hp per wrong letter.</h3>
    <p>Score:
        <span id="user-score"> 0</span>
    </p>
    <p>HP:
        <span id="user-hp">6</span>
    </p>
    <p>Word:
        <span id="user-display"></span>
    </p>
    <p>Checked:
        <span id="user-checked"></span>
    </p>
    <p>
        Words gotten:
        <span id="user-gotten"></span>
    </p>
    <script>
        var hpShow = document.getElementById("user-hp");
        var displayShow = document.getElementById("user-display");
        var checkedShow = document.getElementById("user-checked");
        var scoreShow = document.getElementById("user-score");
        var gottenShow = document.getElementById("user-gotten");
        var hp = Math.floor(6);
        var match = Math.floor(0); //how many letters of the words the player got right
        var score = Math.floor(0);
        var display = []; //the array to save the letters already gotten right
        var checked = []; // to save all geussed letters
        var answer = [];
        var wordBank = ["HTML", "CSS", "JAVASCRIPT", "BOOTSTRAP", "ARRAYS", "OBJECT", "METHOD", "FUNCTION", "SCOPE", "CLASS", "SYNTAX"];
        var wordsRight = [];
        var tempString = "";
        var active = false; //user input only valid when active
        var correctSound = document.getElementById("correctAudio");
        var errorSound = document.getElementById("errorAudio");
        //function newWord() {
        const newWord = _=>{ 
            if (wordBank.length != 0) {
                display = [];
                var rand = Math.floor(Math.random() * wordBank.length);
                console.log(rand);
                answer = wordBank[rand].split("");
                wordBank.splice(rand, 1);
                match = answer.length;
                console.log(match);
                for (i = 0; i < answer.length; i++) {
                    display.push("_");
                }
                displayShow.textContent = display;
                checked = [];
                checkedShow.textContent = checked;
                active = true;
            }
            else {
                setTimeout(_ => { location.reload(true); }, 2000);
                //setTimeout(function () { location.reload(true); }, 2000);
                document.write("YOU WIN");
                active = false;
            }
        }
        //initialize game
        newWord();
        hpShow.textContent = hp;
        //console.log(wordBank);
        //console.log(checked);
        //console.log(display);
        //console.log(answer);
    </script>

    <script>
        //Main structure
        document.onkeydown = event => {
            //document.onkeydown = function (event) {
            var keyPressed = String.fromCharCode(event.keyCode);
            if (active) {
                if (event.keyCode < 91 && event.keyCode > 64) {
                    //console.log(event.keyCode);
                    //console.log(keyPressed);
                    if (checked.indexOf(keyPressed) == -1) {
                        checked.push(keyPressed);
                        checkedShow.textContent = checked;
                        //console.log(checked);
                        if (answer.indexOf(keyPressed) != -1) {
                            //console.log("yay");
                            for (var i = 0; i < answer.length; i++) {
                                if (answer[i] == keyPressed) {
                                    display[i] = keyPressed;
                                    match--;
                                }
                                console.log(match);
                                displayShow.textContent = display;

                            }
                            if (match == 0) {
                                score++;
                                hp += 2;
                                hpShow.textContent = hp;
                                correctSound.play();
                                //console.log(answer.join(""));
                                wordsRight.push(answer.join(""));
                                scoreShow.textContent = score;
                                gottenShow.textContent = wordsRight;
                                active = false;
                                //setTimeout(function () { newWord(); }, 2000);
                                setTimeout(newWord, 2000);


                            }
                        }
                        else {
                            hp--;
                            errorSound.play();
                            hpShow.textContent = hp;
                            if (hp < 1) {
                                displayShow.textContent = answer;
                                active = false;
                                setTimeout(_ => { document.write("YOU LOSE. Final Score: " + score); }, 2000);
                                setTimeout(_ => { location.reload(true); }, 4000);
                            }
                            //console.log(hp);
                            //to do: gotta block more input between timeout time
                        }
                    }
                    //console.log(checked);
                }

            }
        }





    </script>
</body>

</html>